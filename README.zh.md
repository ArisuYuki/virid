# virid

`virid` 是一个用`TypeScript`语言编写的为重型逻辑而生的**确定性消息驱动引擎**。它将业务逻辑从 UI 框架的碎屑中彻底剥离，构建出一个具备**位置透明性**、**时空可回溯性**与**跨进程主权**的微型分布式核心。

## 🛠️ 核心理念

`virid` 通过将逻辑与视图彻底解耦，解决了中大型前端项目与electron项目中的“状态漂移”与“逻辑面条化”问题。其核心运作机制如下：

- **环境无关的逻辑内核**：业务逻辑完全运行在 `@virid/core` 中，不依赖 DOM/BOM API。这使得同一套核心逻辑可以无缝运行在 Electron 主进程、渲染进程或 Node.js 环境中。
- **单向数据投影**：UI 层（Vue）通过 `@virid/vue` 接入。它仅作为逻辑层数据的**只读视图**。系统从底层屏蔽了视图层对状态的直接修改，确保数据变更的源头唯一。
- **指令驱动的异步调度**：系统所有的状态变更必须通过 `Message` 触发。`Dispatcher` 采用类似游戏引擎的 `Tick` 机制处理消息，由 `System` 完成具体的业务运算，确保逻辑执行顺序的可预测性。
- **进程IPC通讯屏蔽**：Virid提供了完整的渲染进程与主进程之间的消息机制，彻底屏蔽了底层的IPC通讯，使用Virid在electron中通讯如同在本地通讯完全相同。

## 📦 模块组成

| **模块**                       | **定位**                 | **关键特性**                               |
| ------------------------------ | ------------------------ | ------------------------------------------ |
| **`@virid/core`**              | **核心**                 | 确定性 Tick 机制、双缓冲消息池、依赖注入。 |
| **`@virid/vue`**               | **UI投影层**             | 响应式投影、依赖系留、生命周期桥接。       |
| **`@virid/electron-bridge`**   | **electron消息转发层**   | -                                          |
| **`@virid/electron-renderer`** | **electron渲染进程桥接** | 渲染进程消息发送、主进程消息反序列化       |
| **`@virid/electron-main`**     | **electron主进程桥接**   | 消息路由、渲染进程转发                     |
| **`@virid/amber`**             | **状态管理**             | 消息重放、状态回溯、undo/redo              |

## 🎯 核心优势

1. **确定的逻辑执行顺序**：引入类似游戏引擎的 `Tick` 调度机制与双缓冲消息池，彻底消除复杂 UI 交互中常见的“竞态条件”与逻辑抖动。
2. **原生支持自动化测试**：由于逻辑内核与 DOM 彻底解耦，开发者可以在纯 Node.js 或 Vitest 环境下，通过模拟消息序列完成 100% 的业务逻辑测试，无需任何 UI 层面的 Mock。
3. **严谨的状态变更审计**：基于单向数据流和指令驱动模式。系统可以自动记录每一条消息引发的状态变更，为实现 **Time Machine（撤销/重做）**、**操作日志回溯**及**故障复现**提供底层支持。
4. **跨进程无缝通信**：专门针对 Electron 环境优化。内置透明的消息路由机制，将复杂的 IPC 通信简化为标准的消息发送，大幅降低多窗口、多进程协作应用的开发难度。

---

## 🔗 深入了解

具体的实现细节与快速上手示例，请阅读各子包文档：

- 👉 **[@virid/core](packages/core/README.md)** - 了解 CCS 架构、消息调度与状态管理。
- 👉 **[@virid/vue](packages/vue/README.md)** - 了解如何将逻辑投影到 Vue 视图层。
- 👉 **[@virid/electron-bridge](packages/electron-bridge/README.md)** - 了解如何初始化electron渲染脚本
- 👉 **[@virid/electron-renderer](packages/electron-renderer/README.md)** - 了解如何从渲染进程直接向主进程发消息
- 👉 **[@virid/electron-main](packages/electron-main/README.md)** - 了解主进程如何处理渲染进程消息
- 👉 **[@virid/amber](packages/amber/README.md)** - 了解如何使用消息重放、undo/redo功能
