# @virid/vue

> **The Bridge between virid Core and Vue.**
>
> **ä½¿ Vue æˆä¸º virid å¼•æ“æœ€åä¸½çš„â€œçŠ¶æ€æŠ•å½±ä»ªâ€ã€‚**

## ğŸ§© å®šä½ï¼šç»Ÿæ²»è§†å›¾æŠ•å½±

`@virid/vue` ç»éä¸€ä¸ªæ™®é€šçš„ Vue çŠ¶æ€ç®¡ç†æ’ä»¶ã€‚ç›¸åï¼Œåœ¨ virid çš„ä¸–ç•Œè§‚é‡Œï¼š**Vue æ‰æ˜¯ virid çš„æ’ä»¶ã€‚**

### æ ¸å¿ƒå“²å­¦ï¼šæ¶æ„ä¸»æƒ

ä¼ ç»Ÿçš„å¼€å‘æ¨¡å¼æ˜¯â€œåœ¨ Vue ä¸­å†™ä¸šåŠ¡â€ï¼›è€Œåœ¨ virid ä¸­ï¼Œ**ä¸šåŠ¡åœ¨ Core ä¸­æ°¸ç”Ÿ**ï¼ŒVue ä»…ä»…æ˜¯ä¸šåŠ¡é€»è¾‘åœ¨æµè§ˆå™¨ DOM ä¸Šçš„ä¸€å±‚**ä¸´æ—¶æŠ•å½±**ã€‚

- **é€»è¾‘ä¸»æƒ**ï¼šæ‰€æœ‰çš„å› æœå¾‹ï¼ˆMessageï¼‰ã€è§„åˆ™é›†ï¼ˆSystemï¼‰å’Œæ•°æ®æºï¼ˆComponentï¼‰éƒ½ç‹¬ç«‹äº Vue è¿è¡Œã€‚
- **è§†å›¾ç»ˆç«¯**ï¼šVue å¤±å»äº†å¯¹çŠ¶æ€çš„ä¿®æ”¹æƒã€‚å®ƒè¢«é™çº§ä¸ºä¸€ä¸ªæ™ºèƒ½ç»ˆç«¯ï¼Œä»…è´Ÿè´£æ¥æ”¶æŠ•å½±å¹¶è§¦å‘æŒ‡ä»¤ã€‚

### ğŸ›¡ï¸ å®ƒä¸º Core å¢åŠ äº†ä»€ä¹ˆèƒ½åŠ›ï¼Ÿ

å¦‚æœè¯´ Core æ˜¯å¤§è„‘ï¼Œé‚£ä¹ˆ `@virid/vue` å°±ä¸ºå¤§è„‘æ¥å…¥äº†ç¥ç»å…ƒã€‚å®ƒèµ‹äºˆäº† Core è·¨è¶Šâ€œé€»è¾‘ä¸è§†å›¾â€é¸¿æ²Ÿçš„ç‰¹æƒï¼š

#### 1. **æ•°æ®ç°ä¸–åŒ–ï¼šå“åº”å¼æŠ•å½± (Reactive Projection)**

Core é‡Œçš„ `Component` åªæ˜¯çº¯ç²¹çš„æ•°æ®ç»“æ„ï¼Œæœ¬æ— æ³•é©±åŠ¨ UIã€‚

- **èƒ½åŠ›å¢å¼º**ï¼šé€šè¿‡ `@Project` å’Œ `@Responsive`ï¼Œæ’ä»¶å°† Core å†…éƒ¨çš„é™æ€æ•°æ®é€šè¿‡ **Deep Shield (æ·±åº¦æŠ¤ç›¾)** è½¬åŒ–ä¸º Vue çš„å“åº”å¼ Proxyã€‚
- **èƒ½åŠ›è¡¨ç°**ï¼šæ•°æ®åœ¨ Core ä¸­å‘ç”Ÿåç§»ï¼ŒUI è‡ªåŠ¨æ„Ÿåº”ï¼›ä½† UI è¯•å›¾ç›´æ¥ä¿®æ”¹æŠ•å½±æ—¶ï¼ŒæŠ¤ç›¾ä¼šç«‹å³æ‹¦æˆªã€‚

#### 2. **æ„ŸçŸ¥ååŒï¼šè·¨å±‚çº§ä¾èµ–ç³»ç•™ (Dependency Tethering)**

Core æ˜¯å•ä¾‹ä¸”æ‰å¹³çš„ï¼Œè€Œ UI æ˜¯æ ‘çŠ¶ä¸”å¤šå˜çš„ã€‚

- **èƒ½åŠ›å¢å¼º**ï¼šæ’ä»¶å¼•å…¥äº† `useController` å’Œ `@Inherit`ã€‚å®ƒè®© Core å…·å¤‡äº†â€œæ„ŸçŸ¥ UI ç»“æ„â€çš„èƒ½åŠ›ã€‚é€šè¿‡ **Global Registry**ï¼Œé€»è¾‘ä¸å†æ­»æ¿ï¼Œå®ƒèƒ½æ ¹æ® UI çš„æŒ‚è½½æƒ…å†µåŠ¨æ€å»ºç«‹â€œé€»è¾‘éš§é“â€ã€‚
- **èƒ½åŠ›è¡¨ç°**ï¼šå­ç»„ä»¶é€šè¿‡ `@Inherit` å¼±å¼•ç”¨çˆ¶çº§é€»è¾‘ï¼Œé€»è¾‘çš„æµåŠ¨æ–¹å‘ä¸¥ä¸åˆç¼åœ°éµå¾ª Core å®šä¹‰çš„æ‹“æ‰‘ç»“æ„ã€‚

#### 3. **å› æœé—­ç¯ï¼šUI é€»è¾‘çš„å³æ—¶è£å†³ (Immediate UI Arbitration)**

Vue è‡ªèº«çš„ç”Ÿå‘½å‘¨æœŸå’Œäº‹ä»¶é€šå¸¸æ˜¯æ··ä¹±çš„ã€‚

- **èƒ½åŠ›å¢å¼º**ï¼šæ’ä»¶å¼•å…¥äº† `@Listener` å’Œ `@OnHook`ã€‚å®ƒè®© UI çš„åŠ¨ä½œï¼ˆå¦‚ç‚¹å‡»ã€æŒ‚è½½ï¼‰ä¸å†ç›´æ¥è¿è¡Œä¸šåŠ¡ï¼Œè€Œæ˜¯è½¬åŒ–ä¸ºä¸€æ¡ `ControllerMessage`ã€‚
- **èƒ½åŠ›è¡¨ç°**ï¼šä¸€åˆ‡ UI è¡Œä¸ºéƒ½è¢«è§„èŒƒåŒ–ä¸ºâ€œæ¶ˆæ¯â€ã€‚Core åƒè£åˆ¤ä¸€æ ·é€šè¿‡ `System` è£å†³è¿™äº›æ¶ˆæ¯ã€‚è¿™ç¡®ä¿äº†å³ä¾¿æ˜¯åœ¨ Vue ç¯å¢ƒä¸‹ï¼Œæ¯ä¸€è¡Œé€»è¾‘çš„æ‰§è¡Œä¹Ÿå¿…é¡»ç»è¿‡ virid è°ƒåº¦ä¸­å¿ƒçš„ä¼˜å…ˆçº§æ’é˜Ÿã€‚

## ğŸš€ å¿«é€Ÿä¸Šæ‰‹ï¼švirid å®æˆ˜ç¤ºä¾‹

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†å®ç°ï¼š**ç‚¹å‡»åˆ—è¡¨ä¸­çš„ä¸€é¦–æ­Œï¼Œé€šè¿‡ Controller å‘é€æŒ‡ä»¤ï¼Œæœ€åç”± System å†³å®šæ’­æ”¾é€»è¾‘ã€‚**

### 1. å®šä¹‰æ•°æ® (Component)

é¦–å…ˆï¼Œåœ¨ Core ä¸­å®šä¹‰ä½ çš„æ•°æ®ç»“æ„ã€‚è¿™é‡Œä¸éœ€è¦å…³å¿ƒ Vueã€‚

```vue
//PlayerComponent.ts import { Component } from '@virid/core' import { Responsive
} from '@virid/vue' @Component() export class PlaylistComponent { @Responsive()
// è®© Core çš„æ•°æ®åœ¨ Vue é‡Œå¯æ„Ÿåº” public currentSongName: string = 'æœªæ’­æ”¾' }
```

### 2. å®šä¹‰æŒ‡ä»¤ (Message)

å®šä¹‰ç”¨æˆ·æƒ³åšä»€ä¹ˆã€‚

```
// logic/messages.ts
import { SingleMessage } from '@virid/core'

export class PlaySongMessage extends SingleMessage {
  constructor(public songName: string) { super() }
}
```

### 3. å®šä¹‰è§„åˆ™ (System)

åœ¨ Core ä¸­ç¼–å†™ä¸šåŠ¡é€»è¾‘ã€‚å®ƒæ˜¯ç»å¯¹çš„è£åˆ¤ã€‚

```
// PlayerSystem.ts
import { System, Message } from '@virid/core'
import { PlaySongMessage } from '../messages'
import { PlaylistComponent } from '../components/PlayerComponent'

export class PlayerSystem {
  @System()
  static onPlay(@Message(PlaySongMessage) msg: PlaySongMessage, state: PlaylistComponent) {
    // æ‰€æœ‰çš„é€»è¾‘é—­ç¯åœ¨è¿™é‡Œï¼šä¿®æ”¹æ•°æ®
    state.currentSongName = msg.songName
    console.log(`Core æ­£åœ¨æ’­æ”¾: ${msg.songName}`)
  }
}
```

### 4. æ¥å…¥è§†å›¾ (Controller & Vue)

è¿™æ˜¯ `@virid/vue` å±•ç°é­”åŠ›çš„åœ°æ–¹ã€‚å®ƒæŠŠé€»è¾‘â€œæŠ•å½±â€ç»™ Vueã€‚

**Controller (é€»è¾‘é€‚é…å™¨):**

```
// logic/controllers/SongController.ts
import { Controller } from '@virid/core'
import { Project } from '@virid/vue'
import { PlaylistComponent } from '../components/PlayerComponent'
import { PlaySongMessage } from '../messages'

@Controller()
export class SongController {
  @Project(PlaylistComponent, (c) => c.currentSongName)
  public playing!: string // æŠ•å½±ï¼šåªè¯» Core çš„æ•°æ®
  //å®šä¹‰è‡ªå·±çš„æ•°æ®
  @Responsive()
  public list = ['think of you', 'ROCK IN!', 'Instant Love']

  play(name: string) {
    PlaySongMessage.send(name) // å‘é€æŒ‡ä»¤ï¼Œè€Œä¸æ˜¯ç›´æ¥æ”¹æ•°æ®
  }
}
```

**Vue ç»„ä»¶:**

```
<template>
  <div>
    <h3>å½“å‰æ’­æ”¾ï¼š{{ ctrl.playing }}</h3>
    <ul>
      <li v-for="s in ctrl.list" @click="ctrl.play(s)">ç‚¹å‡»æ’­æ”¾ï¼š{{ s }}</li>
    </ul>
  </div>
</template>

<script setup lang="ts">
import { useController } from '@virid/vue'
import { SongController } from './logic/controllers/SongController'
//æ‰€æœ‰çš„é­”æ³•åœ¨è¿™é‡Œå‘ç”Ÿ
const ctrl = useController(SongController)
</script>
```

---

## ğŸ“˜ virid æ ¸å¿ƒæ¦‚å¿µï¼šé€šä¿—æ¼”ä¹‰ç‰ˆ

### 1. `@Project` â€”â€” å•å‘é€é•œï¼ˆæŠ•å½±ä»ªï¼‰

- **ç™½è¯è§£é‡Š**ï¼šå®ƒå°±åƒæ˜¯ UI å±‚åœ¨ Core å±‚å§å®¤çª—æˆ·ä¸Šè£…çš„ä¸€ä¸ª**å•å‘çŒ«çœ¼**ã€‚
- **å®ƒåœ¨åšä»€ä¹ˆ**ï¼šController é‡Œçš„ `playing` å±æ€§æœ¬èº«æ˜¯ä¸å­˜æ•°æ®çš„ï¼Œå®ƒåªæ˜¯ `PlaylistComponent` ä¸­ `currentSongName` çš„ä¸€ä¸ª**å®æ—¶å½±å­**ã€‚
- **æ½œè§„åˆ™**ï¼šæ—¢ç„¶æ˜¯æŠ•å½±ï¼Œä½ å°±**ä¸èƒ½é€šè¿‡æ”¹å½±å­æ¥æ”¹å˜å®ä½“**ã€‚å¦‚æœä½ åœ¨ Controller é‡Œå°è¯• `this.playing = "æ–°æ­Œ"`ï¼Œæ¡†æ¶ä¼šè­¦å‘Šä½ ï¼šè¿™æ˜¯åªè¯»çš„ï¼æƒ³æ”¹ï¼Ÿå»å‘ `Message`ã€‚

### 2. `@Responsive` â€”â€” å“åº”å¼ç¥ç»å…ƒ

- **ç™½è¯è§£é‡Š**ï¼šç»™æ™®é€šçš„ TypeScript ç±»æ‰“ä¸€é’ˆâ€œVue å…´å¥‹å‰‚â€ã€‚
- **å®ƒåœ¨åšä»€ä¹ˆ**ï¼šåŸæœ¬ Core é‡Œçš„ç±»åªæ˜¯å†·å†°å†°çš„æ•°æ®ç»“æ„ã€‚åŠ äº†å®ƒï¼Œå½“ System åœ¨åº•å±‚ä¿®æ”¹ `state.currentSongName` æ—¶ï¼Œè¿™ä¸ªå˜åŒ–ä¼šé¡ºç€ `@Project` çš„ç®¡é“ï¼Œ**ç¬é—´ç‚¹äº®**æ‰€æœ‰æ­£åœ¨å¼•ç”¨è¿™ä¸ªæ•°æ®çš„ Vue ç»„ä»¶ã€‚
- **æ½œè§„åˆ™**ï¼šå®ƒæ˜¯ UI èƒ½æ„ŸçŸ¥åˆ°é€»è¾‘å˜åŒ–çš„â€œå”¯ä¸€é€šä¿¡åŸºç«™â€ã€‚

### 3. `useController` â€”â€” é€»è¾‘é”šç‚¹ï¼ˆç‰µå¼•ç»³ï¼‰

- **ç™½è¯è§£é‡Š**ï¼šåœ¨ Vue çš„æµ·æ´‹é‡Œï¼Œæ‰”ä¸‹ä¸€ä¸ªé”šç‚¹ï¼ŒæŠŠ Core é‡Œçš„é€»è¾‘æ€ªå…½â€œç‰µâ€è¿‡æ¥ã€‚
- **å®ƒåœ¨åšä»€ä¹ˆ**ï¼šVue ç»„ä»¶è¯´ï¼šâ€œæˆ‘åªæƒ³ç®¡æ ·å¼ï¼Œä¸æƒ³ç®¡æ€ä¹ˆæ’­æ”¾ã€‚â€äºæ˜¯å®ƒé€šè¿‡ `useController` æ‰¾æ¥äº†ä¸€ä¸ªä»£åŠäººï¼ˆControllerï¼‰ã€‚è¿™ä¸ªä»£åŠäººå·²ç»åœ¨ IOC å®¹å™¨é‡Œå‡†å¤‡å¥½äº†ï¼Œç»„ä»¶æŒ‚è½½å®ƒå°±å‡ºç°ï¼Œç»„ä»¶é”€æ¯å®ƒå°±éšé€€ã€‚
- **æ½œè§„åˆ™**ï¼šå®ƒæ˜¯ Vue ä¸–ç•Œä¸ virid Core ä¸–ç•Œçš„**å”¯ä¸€å®˜æ–¹æ¥å£**ã€‚

### 4. `Message.send` â€”â€” å› æœå¾‹å¯åŠ¨ï¼ˆé€’äº¤ç”³è¯·ä¹¦ï¼‰

- **ç™½è¯è§£é‡Š**ï¼šUI å±‚å½»åº•ä¸§å¤±â€œæ‰§æ³•æƒâ€ï¼Œåªèƒ½é€šè¿‡**å‘å¿«é€’**çš„æ–¹å¼å»ºè®® Core å±‚å¹²æ´»ã€‚
- **å®ƒåœ¨åšä»€ä¹ˆ**ï¼šä»¥å‰ä½ åœ¨ Vue é‡Œå†™ `count++`ï¼›ç°åœ¨ä½ åªèƒ½å‘é€ä¸€ä¸ªâ€œæˆ‘æƒ³è®© count åŠ  1â€çš„ç”³è¯·ä¹¦ã€‚
- **ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåš**ï¼šå› ä¸º Systemï¼ˆè£åˆ¤ï¼‰ä¼šæ‹¦æˆªè¿™ä¸ªæ¶ˆæ¯ï¼Œæ£€æŸ¥ä½ æœ‰æ²¡æœ‰æƒé™æ’­æ”¾ã€è¿™é¦–æ­Œåœ¨ä¸åœ¨åº“é‡Œã€‚åªæœ‰è£åˆ¤ï¼ˆSystemï¼‰ç‚¹å¤´äº†ï¼Œæ•°æ®æ‰ä¼šå˜ï¼ŒUI æ‰ä¼šè·³ã€‚

### 5. `@Inherit` â€”â€” é€»è¾‘å¯„ç”Ÿï¼ˆæ— çº¿ç”µæ¥æ”¶æœºï¼‰

- **ç™½è¯è§£é‡Š**ï¼šå®ƒè®©å­ç»„ä»¶åƒâ€œå¯„ç”Ÿè™«â€ä¸€æ ·ï¼Œéš”ç©ºå¸å–çˆ¶ç»„ä»¶ï¼ˆæˆ–å…¶ä»– Controllerï¼‰çš„è¥å…»ã€‚
- **å®ƒåœ¨åšä»€ä¹ˆ**ï¼šä½ çš„ `SongController` ä¸éœ€è¦æ‰‹åŠ¨ä¼  props æ‹¿æ­Œå•ï¼Œåªè¦ç”¨ `@Inherit(PlaylistController, 'playlist')`ï¼Œå®ƒå°±èƒ½è‡ªåŠ¨ä»å…¨å±€æ³¨å†Œè¡¨ä¸­å®šä½åˆ°çˆ¶ç»„ä»¶ï¼Œå¹¶å»ºç«‹ä¸€æ¡æ•°æ®éš§é“ã€‚
- **æ½œè§„åˆ™**ï¼šè¿™æ¡éš§é“æ˜¯â€œå¼±å¼•ç”¨â€ä¸”å¸¦æœ‰â€œæŠ¤ç›¾â€çš„ã€‚å³ä½¿ä½ æ‹¿åˆ°äº†çˆ¶çº§çš„æ•°æ®ï¼Œä½ ä¹Ÿåªèƒ½çœ‹ï¼Œä¸èƒ½ç¢°ï¼ˆåªè¯»ï¼‰ã€‚

### 6. `@Env` â€”â€” èº«ä»½é“­ç‰Œï¼ˆå‡ºç”Ÿè¯æ˜ï¼‰

- **ç™½è¯è§£é‡Š**ï¼šç»„ä»¶å‡ºç”Ÿæ—¶ï¼Œå¤–é¢ï¼ˆVueï¼‰å¡ç»™å®ƒçš„ä¸€å¼ å†™ç€â€œä½ æ˜¯è°â€çš„å°çº¸æ¡ã€‚
- **å®ƒåœ¨åšä»€ä¹ˆ**ï¼šåœ¨ Vue æ¨¡æ¿é‡Œä¼  `:index="index"`ï¼Œåœ¨ Controller é‡Œç”¨ `@Env() public index!: number` æ¥æ”¶ã€‚å®ƒè§£å†³äº†é€»è¾‘å®ä¾‹å¦‚ä½•è·çŸ¥è‡ªå·±åœ¨ UI å±‚çº§ä¸­çš„ç‰©ç†ä½ç½®ï¼ˆæ¯”å¦‚æ˜¯åˆ—è¡¨ä¸­çš„ç¬¬å‡ ä¸ªï¼‰ã€‚
- **æ½œè§„åˆ™**ï¼šå®ƒåªæ˜¯ä¸€ä¸ªå…ƒæ•°æ®æ ‡è®°ï¼Œæé†’ä½ ï¼šè¿™ä¸ªæ•°æ®æ˜¯ä»å¤–éƒ¨ Vue ç¯å¢ƒâ€œç©ºæŠ•â€è¿›æ¥çš„ï¼Œä¸è¦åœ¨é€»è¾‘å±‚ä¹±æ”¹ã€‚

### 7. `@Listener` â€”â€” æ„å›¾é›·è¾¾ï¼ˆä¸­è½¬ç«™ï¼‰

- **ç™½è¯è§£é‡Š**ï¼šçˆ¶ç»„ä»¶åœ¨å®¶é‡Œè£…äº†ä¸ªç›‘æ§ï¼Œä¸“é—¨ç›¯ç€å­ç»„ä»¶å‘å‡ºçš„â€œå±€éƒ¨ä¿¡å·â€ã€‚
- **å®ƒåœ¨åšä»€ä¹ˆ**ï¼šå½“å­ç»„ä»¶å‘å‡ºäº†ä¸€ä¸ª `SongControllerMessage`ï¼Œçˆ¶ç»„ä»¶çš„ `@Listener` ä¼šç¬é—´æ•æ‰åˆ°ã€‚å®ƒè´Ÿè´£æŠŠè¿™äº›é›¶ç¢çš„å°åŠ¨ä½œï¼Œç¿»è¯‘æˆèƒ½æƒŠåŠ¨æ•´ä¸ª Core å¼•æ“çš„å…¨å±€å¤§åŠ¨ä½œã€‚
- **æ½œè§„åˆ™**ï¼šå®ƒåªè´Ÿè´£â€œç¿»è¯‘â€å’Œâ€œè½¬å‘â€ï¼Œå…·ä½“çš„åˆ¤å†³ä¾ç„¶è¦äº¤ç»™ `System`ã€‚

### 8. `@Watch` â€”â€” åŠ¨ä½œä¾¦å¯Ÿå…µ

- **ç™½è¯è§£é‡Š**ï¼šç›¯ç€æŸå—æ•°æ®ï¼Œä¸€æ—¦å®ƒå˜äº†ï¼Œå°±ç«‹åˆ»æ‰§è¡Œä¸€å¥—é¢„å®šçš„â€œå‰¯ä½œç”¨â€ã€‚
- **å®ƒåœ¨åšä»€ä¹ˆ**ï¼šæ¯”å¦‚æ­Œæ›²å˜äº†ï¼Œä½ è¦è°ƒç”¨ Vue Router è·³ä¸ªè½¬ï¼Œæˆ–è€…ç»™æµè§ˆå™¨å¼¹ä¸ªé€šçŸ¥ã€‚è¿™ç±»ä¸å±äºæ ¸å¿ƒä¸šåŠ¡é€»è¾‘ã€ä½†å±äº UI è¡¨ç°çš„éœ€æ±‚ï¼Œäº¤ç»™å®ƒã€‚
- **æ½œè§„åˆ™**ï¼šå®ƒæ—¢èƒ½çœ‹ Core é‡Œçš„ç»„ä»¶æ•°æ®ï¼Œä¹Ÿèƒ½çœ‹ Controller é‡Œçš„æœ¬åœ°æ•°æ®ã€‚å®ƒæ˜¯é€»è¾‘å˜åŠ¨åè§¦å‘ UI æ¶Ÿæ¼ªçš„å¼€å…³ã€‚

### 9. `@Use` â€”â€” å·¥å…·åŒ…ï¼ˆå¤–æŒ‚æ¨¡ç»„ï¼‰

- **ç™½è¯è§£é‡Š**ï¼šåœ¨é€»è¾‘å±‚åˆæ³•åœ°å€Ÿç”¨ Vue ç”Ÿæ€é‡Œçš„â€œé­”æ³•æ­¦å™¨â€ï¼ˆå¦‚ `useRouter`, `useI18n`ï¼‰ã€‚
- **å®ƒåœ¨åšä»€ä¹ˆ**ï¼šé€šè¿‡ `@Use(() => useRouter())`ï¼Œè®©ä½ çš„ Controller æ‹¥æœ‰äº†æ“ä½œè·¯ç”±çš„èƒ½åŠ›ï¼Œè€Œä¸éœ€è¦åœ¨ Vue ç»„ä»¶é‡Œä¼ æ¥ä¼ å»ã€‚
- **æ½œè§„åˆ™**ï¼šå®ƒç¡®ä¿äº†ä½ çš„ä¾èµ–é¡¹æ˜¯å»¶è¿ŸåŠ è½½çš„ï¼Œåªæœ‰åœ¨ Controller çœŸæ­£è¢«æ¿€æ´»æ—¶æ‰ä¼šå»å¯»æ‰¾è¿™äº›å·¥å…·ã€‚

### 10. `@OnHook` â€”â€” ç”Ÿå‘½å‘¨æœŸæ½œæ°´å‘˜

- **ç™½è¯è§£é‡Š**ï¼šæ½œä¼åœ¨ Vue çš„ç”Ÿå‘½å‘¨æœŸé‡Œï¼Œç­‰æ°´ä½åˆ°äº†ï¼ˆæ¯”å¦‚æŒ‚è½½æˆ–é”€æ¯ï¼‰å°±è·³å‡ºæ¥å¹²æ´»ã€‚
- **å®ƒåœ¨åšä»€ä¹ˆ**ï¼šæ¯”å¦‚ `@OnHook('onSetup')`ï¼Œè®©ä½ åœ¨ Controller åˆå§‹åŒ–æ—¶å»æœåŠ¡å™¨æ‹‰å–åˆå§‹æ­Œå•ã€‚
- **æ½œè§„åˆ™**ï¼šå®ƒè®©ä½ çš„ Controller è™½ç„¶ä½åœ¨ Core çš„æ€æƒ³é‡Œï¼Œä½†å´èƒ½ç²¾å‡†è¸©ä¸Š Vue èˆå°çš„èŠ‚æ‹ã€‚

---

## âš¡ è¿™ä¸€å¥—æµç¨‹çš„â€œå› æœé“¾æ¡â€

1. **ç”¨æˆ·åŠ¨ä½œ**ï¼šç”¨æˆ·åœ¨ Vue ç•Œé¢ç‚¹äº†ä¸€ä¸‹ `<li>`ã€‚
2. **Controller ä¼ è¯**ï¼šController è°ƒç”¨ `play(name)` æ–¹æ³•ï¼Œæ‰§è¡Œ `PlaySongMessage.send(name)`ã€‚
3. **æ ¸å¿ƒè°ƒåº¦**ï¼š`Message` é£è¿› Coreï¼Œç”±äºå®ƒç»§æ‰¿è‡ª `SingleMessage`ï¼Œè°ƒåº¦å™¨ä¼šè‡ªåŠ¨æ’é˜Ÿã€‚
4. **è£åˆ¤å†³ç­– (System)**ï¼š`PlayerSystem` è¢«å”¤é†’ï¼Œå®ƒæ‹¿åˆ°æ¶ˆæ¯åŒ…ï¼Œä¿®æ”¹äº† `PlaylistComponent` é‡Œçš„æ•°æ®ã€‚
5. **æ•°æ®æŠ•å½±**ï¼šç”±äºæ•°æ®æ ‡è®°äº† `@Responsive`ï¼Œä¸” Controller æ ‡è®°äº† `@Project`ï¼Œå½±å­å˜é‡ `playing` è‡ªåŠ¨æ›´æ–°ã€‚
6. **UI éœ‡è¡**ï¼šVue å‘ç°æ•°æ®å˜äº†ï¼Œé‡æ–°æ¸²æŸ“ç•Œé¢ï¼Œç”¨æˆ·çœ‹åˆ°â€œå½“å‰æ’­æ”¾â€å˜äº†ã€‚

---

### ğŸ’¡ ä¸ºä»€ä¹ˆè¿™æ ·å†™æ›´ä¼˜é›…ï¼Ÿ

1. **UI é›¶æ™ºå•†**ï¼šVue ç»„ä»¶é‡Œæ²¡æœ‰ä»»ä½•åˆ¤æ–­é€»è¾‘ï¼Œå®ƒåªè´Ÿè´£â€œç‚¹ä¸€ä¸‹å‘ä¸ªæ¶ˆæ¯â€ã€‚
2. **æ•°æ®æåº¦å®‰å…¨**ï¼šç»„ä»¶é‡Œä¸èƒ½ç›´æ¥æ‰§è¡Œ `state.name = 'xxx'`ï¼Œå¿…é¡»é€šè¿‡æ¶ˆæ¯ï¼Œè¿™è®©ä½ çš„é€»è¾‘æµ 100% å¯è¿½è¸ªã€‚
3. **å¼€å‘ä½“éªŒ**ï¼šä½ ä¾ç„¶åœ¨å†™ç†Ÿæ‚‰çš„ Vue æ¨¡æ¿ï¼Œä½†ä½ èƒŒåç«™ç€ä¸€æ•´ä¸ªä¸¥è°¨çš„ Core å¼•æ“ã€‚

## ğŸŒŒ ç»“è¯­ï¼šè®© UI å›å½’æŠ•å½±ï¼Œè®©é€»è¾‘é‡è·è‡ªç”±

åœ¨ä¼ ç»Ÿçš„å¼€å‘æ¨¡å¼ä¸­ï¼Œä¸šåŠ¡é€»è¾‘å¾€å¾€æ²¦ä¸º UI æ¡†æ¶çš„é™„åº¸ï¼Œæ•£è½åœ¨ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸä¸å‰¯ä½œç”¨é’©å­ä¸­ã€‚**virid** çš„è¯ç”Ÿï¼Œæ˜¯ä¸ºäº†é‡æ–°åˆ’å®šè¾¹ç•Œã€‚

æ ¸å¿ƒä¸šåŠ¡é€»è¾‘åº”è¯¥æ˜¯**çº¯ç²¹ã€ç¨³å›ºä¸”å¯æµ‹è¯•çš„**ã€‚å®ƒä¸åº”è¢«ç‰¹å®šçš„ UI æ¸²æŸ“ç®¡çº¿æ‰€ç»‘æ¶ï¼Œè€Œåº”åƒæ˜Ÿè¾°èˆ¬ç‹¬ç«‹è¿è¡Œåœ¨è‡ªå·±çš„è½¨é“ä¸Šã€‚é€šè¿‡å‰¥ç¦» UI çš„ä¸»æƒï¼Œvirid èµ‹äºˆäº†å¼€å‘è€…æ„å»ºè·¨ç«¯ã€é«˜é²æ£’æ€§å¤æ‚ç³»ç»Ÿçš„èƒ½åŠ›ã€‚

## ç¤ºä¾‹ä¸­çš„éƒ¨åˆ†æ•°æ®æµå‘å›¾

```mermaid
graph TD
    %% è§†å›¾å±‚
    subgraph ViewLayer ["Vue View Layer"]
        SUI(["Song.vue"]) -->|Click| SC[SongController]
    end

    %% é€‚é…å±‚ï¼šè£…é¥°å™¨é­”æ³•ä¸æ¶ˆæ¯è·¯ç”±
    subgraph Adapter ["virid Vue Adapter"]
        direction TB
        SC -->|"SongControllerMessage.send(this.index)"| SCM["SongControllerMessage (Local)"]

        %% æ ¸å¿ƒæ‹¦æˆªé€»è¾‘
        SCM -->|"@Listener"| PC[PlaylistController]

        subgraph Magic ["Logic Decoration"]
            SC -- "@Env" --> E["index (From Context)"]
            SC -- "@Inherit" --> I["playlist (From PC)"]
            SC -- "@Project" --> P["song (Computed by index)"]
        end

        PC -->|"PlaySongMesage.send(song)"| PSM["PlaySongMesage (Global Domain)"]
    end

    %% æ ¸å¿ƒå¼•æ“ï¼šç¡®å®šæ€§å¤„ç†
    subgraph Core ["virid Core Engine"]
        direction TB
        PSM --> Hub["EventHub (Queueing)"]
        Hub -->|"Tick / Buffer Flip"| Active["Active Pool"]

        subgraph Execution ["System Execution"]
            Active --> Sys["Player.playThisSong (Static)"]
            DI[("(Inversify Container)")] -.->|Inject| PLC["PlaylistComponent"]
            DI -.->|Inject| PCMP["PlayerComponent"]
            Sys -->|"Update currentSong"| PLC
            Sys -->|"Call player.play()"| PCMP
        end
    end

    %% å“åº”å¼å›é¦ˆ
    subgraph Feedback ["Reactive Feedback Loop"]
        PLC -->|"@Responsive"| Mirror["State Mirror"]
        Mirror -->|"@Project / @Watch"| HPC["HomePageController"]
        HPC -->|Sync| HUI(["HomePage.vue"])
    end

    %% æ ·å¼
    style Core fill:#f9f9f9,stroke:#333,stroke-width:2px
    style Adapter fill:#e1f5fe,stroke:#01579b
    style ViewLayer fill:#fff,stroke:#ef6c00
    style DI fill:#e8f5e9,stroke:#2e7d32
```
